#                               paste0("0",as.character(statesNeeded[j])),
#                               statesNeeded[j])
#     readID <- paste0("cb_2017_", addZero,"_tract_500k")
#     vec <- append(vec, readID)
#     for (k in 1:length(vec)) {
#       assign(vec[k], readOGR(".", vec[k]))
#     }
#   }
# } THIS IS RUNNING INTO PROBLEMS BECAUSE IMPORTING SAME STATE MULT TIMES
vec <- NULL
stateList <- unique(transitCollapse$st)
for (j in 1:length(stateList)){
addZero <- ifelse(stateList[j] < 10, # append 0 to front of string to align w shp naming scheme
paste0("0",as.character(stateList[j])),
stateList[j])
readID <- paste0("cb_2017_", addZero,"_tract_500k")
vec <- append(vec, readID)
}
for (k in 1:length(vec)) {
assign(vec[k], readOGR(".", vec[k]))
}
unique(transitList[1][,3])
View(transitList)
# 1. ATLANTA, GA
currentCity <- as.data.frame(transitList[1])
unique(currentCity[,3])
currentShp <- merge(cb_2017_13_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
head(currentCity)
currentShp <- merge(cb_2017_13_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "ATLANTA..GA.geoid")
# Time for brute force.
# Why? Because once you use assign(vec[k], readOGR(".", vec[k]))
# it's practically impossible to select this particular shapefile by name
sp.na.omit <- function(x, col.name = NULL, margin = 1) {
if (!inherits(x, "SpatialPointsDataFrame") &
!inherits(x, "SpatialPolygonsDataFrame") &
!inherits(x, "SpatialLinesDataFrame") )
stop("MUST BE sp SpatialPointsDataFrame OR SpatialPolygonsDataFrame class object")
if(!is.null(col.name)) {
if(is.na(match(col.name, names(x)))) stop(col.name, "does not exist in data")
return( x[-which(is.na(x@data[,col.name])),] )
} else {
na.index <- unique(as.data.frame(which(is.na(x@data), arr.ind = TRUE))[, margin])
if (margin == 1) {
cat("Deleting rows: ", na.index, "\n")
return(x[-na.index, ])
}
if (margin == 2) {
cat("Deleting columns: ", na.index, "\n")
return(x[, -na.index])
}
}
}
currentShp <- sp.na.omit(currentShp)
# CHECK: currentShp has 918 features, same as currentCity
writeOGR(currentShp, ".", "ATLANTA,GA", driver = "ESRI Shapefile")
# 1. ATLANTA, GA
currentCity <- as.data.frame(transitList[1])
unique(currentCity[,3]) # 13
colnames(currentCity)
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_13_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
# CHECK: currentShp has 918 features, same as currentCity
writeOGR(currentShp, ".", "ATLANTA,GA", driver = "ESRI Shapefile")
# CHECK: currentShp has 918 features, same as currentCity
writeOGR(currentShp, ".", "res_ATL_GA", driver = "ESRI Shapefile")
# 2.
currentCity <- as.data.frame(transitList[2])
head(currentCity)
unique(currentCity[,3]) # 24
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_24_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
# CHECK: currentShp has 918 features, same as currentCity
writeOGR(currentShp, ".", "res_BAL_MD", driver = "ESRI Shapefile")
# 3. ATLANTA, GA
currentCity <- as.data.frame(transitList[3])
head(currentCity)
unique(currentCity[,3]) # 1
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_01_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
# CHECK: currentShp has 918 features, same as currentCity
writeOGR(currentShp, ".", "res_BIR_AL", driver = "ESRI Shapefile")
# 4.
currentCity <- as.data.frame(transitList[4])
head(currentCity)
unique(currentCity[,3]) # 1
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_25_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_BOS_MA1", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_33_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_BOS_MA2", driver = "ESRI Shapefile")
# 5. BIRMINGHAM, AL
currentCity <- as.data.frame(transitList[5])
unique(currentCity[,3]) # 1
head(currentCity)
# 5. BUFFALO, NY
currentCity <- as.data.frame(transitList[5])
unique(currentCity[,3]) # 36
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_36_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_BUF_NY", driver = "ESRI Shapefile")
# 6. BUFFALO, NY
currentCity <- as.data.frame(transitList[5])
# 6. BUFFALO, NY
currentCity <- as.data.frame(transitList[6])
head(currentCity)
# 6. CHARLOTTE, NC
currentCity <- as.data.frame(transitList[6])
unique(currentCity[,3]) # 36
unique(currentCity[,3]) # 37, 45
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_37_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_CHA_NC1", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_45_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_CHA_NC2", driver = "ESRI Shapefile")
# 7. BUFFALO, NY
currentCity <- as.data.frame(transitList[7])
head(currentCity)
# 7. CINCINNATI, OH
currentCity <- as.data.frame(transitList[7])
unique(currentCity[,3]) # 36
unique(currentCity[,3]) # 18, 21, 39
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_18_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_CIN_OH", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_18_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_CIN_OH1", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_21_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_CIN_OH2", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_39_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_CIN_OH3", driver = "ESRI Shapefile")
# 8. BUFFALO, NY
currentCity <- as.data.frame(transitList[8])
currentCity
# 8. CLEVELAND, OH
currentCity <- as.data.frame(transitList[8])
unique(currentCity[,3]) # 36
unique(currentCity[,3]) # 39
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_39_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_CLE_OH", driver = "ESRI Shapefile")
# 9. CLEVELAND, OH
currentCity <- as.data.frame(transitList[9])
head(currentCity)
# 9. COLUMBUS, OH
currentCity <- as.data.frame(transitList[9])
unique(currentCity[,3]) # 39
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_39_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_COL_OH", driver = "ESRI Shapefile")
# 10. CLEVELAND, OH
currentCity <- as.data.frame(transitList[10])
head(currentCity)
# 10. DENVER, CO
currentCity <- as.data.frame(transitList[10])
unique(currentCity[,3]) # 39
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_08_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_DEN_CO", driver = "ESRI Shapefile")
# 11. CLEVELAND, OH
currentCity <- as.data.frame(transitList[11])
unique(currentCity[,3]) # 39
head(currentCity)
# 11. HAMILTON, OH
currentCity <- as.data.frame(transitList[11])
unique(currentCity[,3]) # 39
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_39_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_HAM_OH", driver = "ESRI Shapefile")
# 12. CLEVELAND, OH
currentCity <- as.data.frame(transitList[12])
unique(currentCity[,3]) # 39
head(currentCity)
# 12. INDIANAPOLIS, IN
currentCity <- as.data.frame(transitList[12])
unique(currentCity[,3]) # 18
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_18_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_IND_IN", driver = "ESRI Shapefile")
# 13. CLEVELAND, OH
currentCity <- as.data.frame(transitList[13])
head(currentCity)
# 13. KANSAS CITY, MO
currentCity <- as.data.frame(transitList[13])
unique(currentCity[,3]) # 39
# 13. KANSAS CITY, MO
currentCity <- as.data.frame(transitList[13])
unique(currentCity[,3]) # 20, 29
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_20_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_KAN_MO1", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_29_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_KAN_MO2", driver = "ESRI Shapefile")
# 14. INDIANAPOLIS, IN
currentCity <- as.data.frame(transitList[14])
head(currentCity)
# 14. LOUISVILLE, KY
currentCity <- as.data.frame(transitList[14])
unique(currentCity[,3]) # 18
unique(currentCity[,3]) # 18, 21
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_18_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_LOU_KY1", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_21_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_LOU_KY2", driver = "ESRI Shapefile")
# 15. INDIANAPOLIS, IN
currentCity <- as.data.frame(transitList[15])
head(currentCity)
unique(currentCity[,3]) # 18
currentShp <- merge(cb_2017_27_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_MIN_MN1", driver = "ESRI Shapefile")
currentCity
# 15. MINNEAPOLIS, MN
currentCity <- as.data.frame(transitList[15])
unique(currentCity[,3]) # 27, 55
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_27_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_MIN_MN1", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_27_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_MIN_MN1", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_55_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_MIN_MN2", driver = "ESRI Shapefile")
# 16. INDIANAPOLIS, IN
currentCity <- as.data.frame(transitList[16])
head(currentCity)
# 16. NEW ORLEANS, LA
currentCity <- as.data.frame(transitList[16])
unique(currentCity[,3]) # 18
unique(currentCity[,3]) # 22
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_18_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- merge(cb_2017_22_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_NEW_LA", driver = "ESRI Shapefile")
# 17. INDIANAPOLIS, IN
currentCity <- as.data.frame(transitList[17])
head(currentCity)
# 17. NORFOLK, VA
currentCity <- as.data.frame(transitList[17])
unique(currentCity[,3]) # 18
unique(currentCity[,3]) # 37, 51
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_37_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_NOR_VA1", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_51_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_NOR_VA2", driver = "ESRI Shapefile")
# 17. NORFOLK, VA
currentCity <- as.data.frame(transitList[18])
head(currentCity)
# 17. PITTSBURGH, PA
currentCity <- as.data.frame(transitList[18])
unique(currentCity[,3]) # 37, 51
unique(currentCity[,3]) # 42
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_42_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_PIT_PA", driver = "ESRI Shapefile")
# 19. PITTSBURGH, PA
currentCity <- as.data.frame(transitList[19])
head(currentCity)
# 19. PORTLAND, OR
currentCity <- as.data.frame(transitList[19])
unique(currentCity[,3]) # 42
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_41_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_POR_OR", driver = "ESRI Shapefile")
writeOGR(currentShp, ".", "res_POR_OR1", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_53_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_POR_OR2", driver = "ESRI Shapefile")
# 20. PORTLAND, OR
currentCity <- as.data.frame(transitList[20])
head(currentCity)
unique(currentCity[,3]) #
# 20. PORTLAND, OR
currentCity <- as.data.frame(transitList[20])
unique(currentCity[,3]) # 44
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_44_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_PRO_RI", driver = "ESRI Shapefile")
# 21. PROVIDENCE, RI
currentCity <- as.data.frame(transitList[21])
head(currentCity)
# 21. RALEIGH-DURHAM, NC
currentCity <- as.data.frame(transitList[21])
unique(currentCity[,3]) # 44
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_37_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_RAL_NC", driver = "ESRI Shapefile")
# 22. PROVIDENCE, RI
currentCity <- as.data.frame(transitList[22])
head(currentCity)
unique(currentCity[,3]) # 6
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_06_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_SAC_CA", driver = "ESRI Shapefile")
# 22. SACRAMENTO, CA
currentCity <- as.data.frame(transitList[23])
head(currentCity)
# 23. SAN DIEGO, CA
currentCity <- as.data.frame(transitList[23])
unique(currentCity[,3]) # 6
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_06_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_SAND_CA", driver = "ESRI Shapefile")
# 24. SAN DIEGO, CA
currentCity <- as.data.frame(transitList[24])
unique(currentCity[,3]) # 6
head(currentCity)
# 24. SAN JOSE, CA
currentCity <- as.data.frame(transitList[24])
unique(currentCity[,3]) # 6
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_06_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_SANJ_CA", driver = "ESRI Shapefile")
# 25. SAN DIEGO, CA
currentCity <- as.data.frame(transitList[25])
head(currentCity)
# 25. ST. LOUIS, MO
currentCity <- as.data.frame(transitList[25])
unique(currentCity[,3]) # 6
currentCity <- as.data.frame(transitList[25])
unique(currentCity[,3]) # 17, 29
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_17_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_STL_MO1", driver = "ESRI Shapefile")
currentShp <- merge(cb_2017_29_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_STL_MO2", driver = "ESRI Shapefile")
# 26. SAN JOSE, CA
currentCity <- as.data.frame(transitList[26])
head(currentCity)
# 26. TAMPA, FL
currentCity <- as.data.frame(transitList[26])
unique(currentCity[,3]) # 6
unique(currentCity[,3]) # 12
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_12_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_TAM_FL", driver = "ESRI Shapefile")
# 27. SAN JOSE, CA
currentCity <- as.data.frame(transitList[27])
head(currentCity)
# 27. YOLO, CA
currentCity <- as.data.frame(transitList[27])
unique(currentCity[,3]) # 6
colnames(currentCity) <- c("geoid", "jobs", "st", "cty", "city")
currentShp <- merge(cb_2017_06_tract_500k,
currentCity,
by.x = "GEOID",
by.y = "geoid")
currentShp <- sp.na.omit(currentShp)
writeOGR(currentShp, ".", "res_YOL_CA", driver = "ESRI Shapefile")
